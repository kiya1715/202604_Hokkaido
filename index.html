<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—æµ·é“æ—…éŠæ——è‰¦ç‰ˆ V17</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto+Sans+TC', sans-serif; background-color: #F8FAFC; color: #334155; -webkit-tap-highlight-color: transparent; }
        .bg-serenity { background-color: #91A8D0; }
        .text-serenity { color: #91A8D0; }
        .timeline-line::before { content: ''; position: absolute; left: 19px; top: 0; bottom: 0; width: 2px; background-color: #91A8D0; opacity: 0.2; }
        .boarding-pass { background: linear-gradient(135deg, #91A8D0 0%, #768DB5 100%); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(145,168,208,0.2); }
        .boarding-pass::after { content: ''; position: absolute; bottom: 30px; left: -10px; right: -10px; height: 1px; border-bottom: 2px dashed rgba(255,255,255,0.3); }
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body x-data="travelApp()" x-cloak>

    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-200 z-50 flex justify-around items-center py-2 pb-safe shadow-lg">
        <template x-for="t in ['schedule', 'info', 'packing', 'store', 'budget']">
            <button @click="tab = t" :class="tab === t ? 'text-serenity scale-110' : 'text-gray-400'" class="flex flex-col items-center flex-1 transition-all duration-300">
                <i :data-lucide="tabIcons[t]" class="w-6 h-6"></i>
                <span class="text-[10px] mt-1 font-bold" x-text="tabNames[t]"></span>
            </button>
        </template>
    </nav>

    <main class="pb-28 pt-4 px-4 max-w-md mx-auto">
        <header class="mb-4 flex justify-between items-center border-b border-gray-100 pb-2">
            <div><h1 class="text-2xl font-black text-serenity">HOKKAIDO 2026</h1><p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Mobile Flagship V17</p></div>
            <div class="bg-serenity text-white p-2 rounded-full shadow-lg shadow-serenity/30"><i data-lucide="plane" class="w-5 h-5"></i></div>
        </header>

        <div x-show="tab === 'schedule'" x-transition>
            <div class="mb-4 space-y-3">
                <div class="relative">
                    <input type="text" x-model="searchQuery" placeholder="æœå°‹è¡Œç¨‹ã€åœ°é»ã€å‚™è¨»..." class="w-full bg-white rounded-xl p-3 pl-10 text-sm shadow-sm outline-none focus:ring-2 focus:ring-serenity/50 border-none">
                    <i data-lucide="search" class="w-4 h-4 absolute left-3 top-3.5 text-gray-300"></i>
                </div>
                <div class="card p-3 bg-blue-50 border border-blue-100 flex items-center justify-between">
                    <div class="flex items-center gap-3"><i data-lucide="cloud-sun" class="text-blue-400"></i>
                        <p class="text-sm font-bold text-gray-700" x-text="selectedCity + ' å¤©æ°£é å ±'"></p>
                    </div>
                    <a :href="'https://weathernews.jp/onebox/' + (selectedCity === 'æœ­å¹Œ' ? '43.06/141.35' : '42.55/140.82')" target="_blank" class="text-xs bg-blue-400 text-white px-3 py-1 rounded-lg font-bold no-underline">æ•™å­¸é€£çµ</a>
                </div>
            </div>

            <div class="flex overflow-x-auto gap-3 mb-6 hide-scrollbar py-1">
                <template x-for="date in dates">
                    <button @click="selectedDate = date" :class="selectedDate === date ? 'bg-serenity text-white shadow-md scale-105' : 'bg-white text-gray-400'" class="flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all duration-300">
                        <span class="text-[10px] font-bold uppercase" x-text="date.split('/')[1] + 'æœˆ'"></span>
                        <span class="text-xl font-black" x-text="date.split('/')[2]"></span>
                    </button>
                </template>
            </div>

            <template x-if="selectedDate === '2026/04/09' && !searchQuery">
                <div class="card p-5 mb-8 border-l-8 border-orange-400 bg-orange-50 shadow-md">
                    <h3 class="font-bold text-orange-800 flex items-center gap-2 mb-2"><i data-lucide="qr-code" class="w-5 h-5"></i> Visit Japan Web æé†’</h3>
                    <p class="text-sm text-orange-700 mb-4 font-medium leading-snug">å…¥å¢ƒå¿…å‚™æˆªåœ– QR Codeã€‚æ‰˜é‹é™ 23kgã€‚</p>
                    <div class="flex gap-2">
                        <a href="https://www.vjw.digital.go.jp/main/#/vjwplo001" target="_blank" class="bg-orange-400 text-white text-[11px] px-4 py-2 rounded-xl font-bold no-underline text-center flex-1">å‰å¾€å®˜ç¶²</a>
                        <a href="https://jpn-study.com.tw/visit-japan-web/" target="_blank" class="border border-orange-400 text-orange-400 text-[11px] px-4 py-2 rounded-xl font-bold no-underline text-center flex-1">æ•™å­¸é€£çµ</a>
                    </div>
                </div>
            </template>

            <div class="relative timeline-line ml-2">
                <template x-for="item in filteredItinerary" :key="item.Activity + Math.random()">
                    <div class="mb-8 relative pl-10">
                        <div :class="getCatStyles(item.Category).bg" class="absolute left-0 top-1 w-10 h-10 rounded-full flex items-center justify-center text-white z-10 border-4 border-white shadow-sm">
                            <i :data-lucide="getCatStyles(item.Category).icon" class="w-5 h-5"></i>
                        </div>
                        <div class="card p-4">
                            <div class="flex justify-between items-start mb-1">
                                <span class="text-[10px] font-bold text-gray-400" x-text="item.Time || item.TimeOfDay"></span>
                                <span :class="getCatStyles(item.Category).text" class="text-[10px] px-2 py-0.5 rounded-full bg-slate-50 border border-gray-100 font-bold uppercase" x-text="item.Category"></span>
                            </div>
                            <h3 class="font-bold text-gray-800 text-lg leading-tight" x-text="item.Activity"></h3>
                            <div class="mt-2 text-sm text-gray-500 leading-relaxed whitespace-pre-wrap break-words" x-html="item.Notes"></div>
                            
                            <template x-if="shouldShowMap(item.Activity)">
                                <div class="mt-3 flex gap-4 pt-3 border-t border-gray-50">
                                    <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.Activity + ' ' + (item.City || ''))" target="_blank" class="flex items-center text-[11px] text-serenity font-bold no-underline">
                                        <i data-lucide="map-pin" class="w-3 h-3 mr-1"></i> åœ°åœ–
                                    </a>
                                    <a :href="'https://www.clubjt.jp/map/?q=' + encodeURIComponent(item.Activity)" target="_blank" class="flex items-center text-[11px] text-gray-400 no-underline">
                                        <i data-lucide="wind" class="w-3 h-3 mr-1"></i> å¸è¸å€
                                    </a>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="tab === 'info'" x-transition>
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><i data-lucide="info" class="text-serenity"></i> äº¤é€šèˆ‡ä½å®¿</h2>
            <div class="boarding-pass text-white p-6 mb-4">
                <div class="flex justify-between items-center mb-6"><div><p class="text-[10px] opacity-70 uppercase">CI130</p><p class="text-lg font-bold">04/09 (å»ç¨‹)</p></div></div>
                <div class="flex justify-between items-center mb-6 text-center"><p class="text-4xl font-black">TPE</p><i data-lucide="plane" class="w-6 h-6"></i><p class="text-4xl font-black">CTS</p></div>
                <p class="text-xs font-bold">Boarding: 08:00 | Gate: A7</p>
            </div>
            <div class="boarding-pass text-white p-6 mb-6">
                <div class="flex justify-between items-center mb-6"><div><p class="text-[10px] opacity-70 uppercase">CI131</p><p class="text-lg font-bold">04/14 (å›ç¨‹)</p></div></div>
                <div class="flex justify-between items-center mb-6 text-center"><p class="text-4xl font-black">CTS</p><i data-lucide="plane" class="w-6 h-6 rotate-180"></i><p class="text-4xl font-black">TPE</p></div>
                <p class="text-xs font-bold">Boarding: 14:15 | Gate: TBA</p>
            </div>
            <a href="https://www.clubjt.jp/map/" target="_blank" class="card p-5 mb-6 flex items-center justify-between border-l-8 border-gray-400 bg-gray-50/50 no-underline shadow-sm">
                <div class="flex items-center gap-3"><div class="bg-white p-2 rounded-lg text-gray-500 shadow-sm"><i data-lucide="wind" class="w-6 h-6"></i></div><div><h3 class="font-bold text-gray-800 uppercase tracking-tighter">æ—¥æœ¬å¸è¸å€åœ°åœ–</h3><p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">CLUB JT Official</p></div></div>
                <i data-lucide="external-link" class="text-gray-300 w-5 h-5"></i>
            </a>
            <div class="card p-5 border-l-8 border-serenity bg-blue-50/20"><h3 class="font-bold text-lg leading-tight uppercase text-gray-800">ã‚¶ãƒ»ãƒ¬ã‚¤ã‚¯ã‚¹ã‚¤ãƒ¼ãƒˆ æ¹–ã®æ –</h3><div class="mt-2 bg-white/80 p-4 rounded-xl text-xs font-mono font-bold text-gray-600 space-y-1 shadow-sm border border-blue-100"><p class="text-serenity text-[10px] font-black uppercase mb-1 tracking-widest">é ç´„ç·¨è™Ÿ (8å)</p>
            <p>â€¢ T9B3C11A2B3D8</p><p>â€¢ T22F3209C08C2</p><p>â€¢ TB2B86F176D2D</p></div></div>
        </div>

        <div x-show="tab === 'packing'" x-transition>
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><i data-lucide="briefcase" class="text-serenity"></i> è¡Œææ‰“åŒ…æ¸…å–®</h2>
            <div class="space-y-6"><template x-for="cat in packing"><div><h3 class="text-xs font-black text-serenity mb-3 uppercase tracking-widest flex items-center"><span class="w-1.5 h-4 bg-serenity rounded-full mr-2"></span><span x-text="cat.category"></span></h3><div class="card overflow-hidden"><template x-for="item in cat.items"><label class="flex items-center p-4 border-b border-slate-50 last:border-0 active:bg-slate-50 transition-colors"><input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-serenity focus:ring-serenity mr-4" x-model="checkedItems[item]"><span :class="checkedItems[item] ? 'line-through text-gray-300 font-normal' : 'text-gray-700 font-bold'" class="text-sm" x-text="item"></span></label></template></div></div></template></div>
        </div>

        <div x-show="tab === 'store'" x-transition>
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><i data-lucide="shopping-cart" class="text-serenity"></i> å››å¤§è¶…å•†å¿…è²·æ¸…å–®</h2>
            <div class="space-y-8">
                <template x-for="store in conv_store" :key="store.store">
                    <div>
                        <h3 class="font-black text-gray-700 mb-4 flex items-center gap-3"><i data-lucide="star" class="w-5 h-5 text-serenity"></i><span x-text="store.store"></span></h3>
                        <div class="grid gap-4">
                            <template x-for="item in store.items">
                                <div class="card p-5 transition-all duration-300 shadow-sm border border-transparent"><p class="font-black text-serenity text-base mb-1" x-text="item.name"></p><p class="text-xs text-gray-400 leading-relaxed font-medium" x-text="item.desc"></p></div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="tab === 'budget'" x-transition>
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2"><i data-lucide="wallet" class="text-serenity"></i> è²»ç”¨åŠ ç¸½èˆ‡çµ±è¨ˆ</h2>
            <div class="card p-6 mb-6 bg-serenity text-white shadow-xl flex justify-between items-center relative overflow-hidden border-none">
                <div class="relative z-10"><p class="text-[10px] font-bold opacity-70 mb-1 uppercase tracking-widest tracking-tighter">Est. Total Expenses</p><span class="text-2xl font-bold">Â¥</span><span class="text-4xl font-black" x-text="totalJPY.toLocaleString()"></span><p class="mt-2 text-lg font-bold opacity-90">NT$ <span x-text="totalTWD.toLocaleString()"></span></p></div>
                <div class="w-20 h-20 rounded-full border-4 border-white/20 relative flex items-center justify-center overflow-hidden" :style="`background: conic-gradient(#fff ${chartPercent}%, rgba(255,255,255,0.2) 0)`"><div class="absolute inset-2 bg-serenity rounded-full flex items-center justify-center text-[10px] font-black" x-text="chartPercent + '%'"></div></div>
            </div>
            <div class="grid grid-cols-5 gap-1.5 mb-6">
                <template x-for="cat in ['é£Ÿ', 'è¡Œ', 'ä½', 'è³¼', 'ä»–']"><div class="bg-white p-2 rounded-xl shadow-sm text-center border border-gray-50"><p class="text-[10px] text-gray-400 font-bold mb-1" x-text="cat"></p><p class="text-[9px] font-black text-serenity leading-none" x-text="'Â¥'+Math.round(getCatTotal(cat)/1000)+'k'"></p></div></template>
            </div>
            <div class="card p-5 mb-6 space-y-3 shadow-xl">
                <input type="text" x-model="newExpense.desc" placeholder="é …ç›®å…§å®¹" class="w-full border-none rounded-xl p-3 text-sm bg-slate-50 outline-none">
                <div class="flex gap-2"><input type="number" x-model.number="newExpense.amount" placeholder="é‡‘é¡" class="flex-grow border-none rounded-xl p-3 text-sm bg-slate-50 outline-none"><select x-model="newExpense.currency" class="border-none rounded-xl px-2 bg-slate-50 text-xs font-bold text-serenity"><option value="JPY">æ—¥åœ“ Â¥</option><option value="TWD">å°å¹£ $</option></select></div>
                <select x-model="newExpense.category" class="w-full border-none rounded-xl p-3 bg-slate-50 text-sm font-bold text-gray-500"><option value="é£Ÿ">ğŸ½ï¸ é£Ÿ</option><option value="è¡Œ">ğŸšŒ è¡Œ</option><option value="ä½">ğŸ¨ ä½</option><option value="è³¼">ğŸ›ï¸ è³¼</option><option value="ä»–">ğŸ“¦ ä»–</option></select>
                <button @click="addExpense" class="w-full bg-serenity text-white py-3 rounded-xl font-black shadow-lg shadow-serenity/40 active:scale-95 transition-all">è¨˜éŒ„æ”¯å‡º</button>
            </div>
            <div class="space-y-2"><template x-for="(exp, index) in expenses" :key="exp.id"><div class="card p-4 flex justify-between items-center hover:bg-slate-50 transition-colors"><div class="flex items-center gap-4"><div class="text-lg" x-text="getCategoryEmoji(exp.category)"></div><div><p class="text-sm font-bold text-gray-700" x-text="exp.desc"></p><p class="text-[10px] text-gray-400 font-medium" x-text="exp.date"></p></div></div><div class="text-right flex items-center gap-4"><p class="text-sm font-black text-serenity" x-text="(exp.currency === 'JPY' ? 'Â¥' : '$') + exp.amount.toLocaleString()"></p><button @click="deleteExpense(index)" class="text-red-200 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div></div></template></div>
        </div>
    </main>

    <script>
        const FULL_DATA = {
            itinerary: [
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "æ—©ä¸Š", "Category": "äº¤é€š", "Time": "~06:00", "Activity": "æ¡ƒåœ’æ©Ÿå ´é›†åˆ", "Notes": "- å°åŒ—ï¼šæ©Ÿå ´æ¥é€<br>- è±åŸï¼šæ©Ÿå ´æ¥é€<br>- å°å—ï¼šé–‹è»Š"},
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "ä¸‹åˆ", "Category": "äº¤é€š", "Time": "08:35-13:30", "Activity": "CI130", "Notes": "Check VJW / è‡ªå‹•æŸ¥é©—é€šé—œ / æ‰˜é‹ä¸€ä»¶ 23kg"},
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "ä¸‹åˆ", "Category": "äº¤é€š", "Time": "ç´„14:20", "Activity": "å‰å¾€æœ­å¹Œå¸‚å€", "Notes": "åº§æ¨™ï¼š42.924, 141.352"},
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "ä¸‹åˆ", "Category": "ä½å®¿", "Time": "15:00å¾Œå¯", "Activity": "Mitsui Garden Hotel West Check-in", "Notes": "å…è²» Bar (15:00-21:00) / æœ‰å¤§æµ´å ´"},
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "ä¸‹åˆ", "Category": "æ™¯é»", "Time": "16:00", "Activity": "åŒ—æµ·é“å¤§å­¸ Marche CafÃ©", "Notes": "ç”œé»ï¼‹ä¸‹åˆèŒ¶"},
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "ä¸‹åˆ", "Category": "å…¶ä»–", "Time": "16:30", "Activity": "å¼„é ­é«® (å¤§å§/å°å°/æ€æ¶µ)", "Notes": "éœ€è¦é ç´„"},
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "æ™šä¸Š", "Category": "æ™¯é»", "Time": "18:00", "Activity": "æœ­å¹Œè»Šç«™å‘¨é‚Š", "Notes": "å¤§é€šå…¬åœ’ / æ™‚è¨ˆå° / é›»è¦–å¡”"},
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "æ™šä¸Š", "Category": "é¤å»³", "Time": "20:00", "Activity": "è¿´è½‰å£½å¸ æ ¹å®¤èŠ±ä¸¸ JR Tower", "Notes": "éœ€æŠ½è™Ÿç¢¼ç‰Œ"},
                {"Date": "2026/04/09", "City": "æœ­å¹Œ", "TimeOfDay": "æ™šä¸Š", "Category": "é€›è¡—", "Time": "22:00", "Activity": "ä¾¿åˆ©å•†åº—", "Notes": "å›é£¯åº—ä¼‘æ¯"},
                {"Date": "2026/04/10", "City": "æœ­å¹Œ", "TimeOfDay": "æ—©ä¸Š", "Category": "é¤å»³", "Time": "10:30", "Activity": "åŒ—ã®ã‚°ãƒ«ãƒ¡äº­ å ´å¤–å¸‚å ´", "Notes": "æ¥é§è»Šé£¯åº—å‡ºç™¼ (10åˆ†é˜)"},
                {"Date": "2026/04/10", "City": "æœ­å¹Œ", "TimeOfDay": "ä¸‹åˆ", "Category": "é€›è¡—", "Time": "14:00", "Activity": "PARCO æœ­å¹Œ / è²å°è·¯", "Notes": "è‡ªç”±æ´»å‹•"},
                {"Date": "2026/04/10", "City": "æœ­å¹Œ", "TimeOfDay": "æ™šä¸Š", "Category": "é¤å»³", "Time": "19:00", "Activity": "æˆå‰æ€æ±—çƒ¤è‚‰", "Notes": "éœ€è¦é ç´„"},
                {"Date": "2026/04/10", "City": "æœ­å¹Œ", "TimeOfDay": "æ™šä¸Š", "Category": "é¤å»³", "Time": "21:00", "Activity": "é¤å¾Œè–ä»£ (å¤œãƒ‘ãƒ•ã‚§)", "Notes": "éœ€æŠ½æ•´ç†åˆ¸"},
                {"Date": "2026/04/11", "City": "æœ­å¹Œ", "TimeOfDay": "æ—©ä¸Š", "Category": "äº¤é€š", "Time": "10:30", "Activity": "å‡ºç™¼å»å°æ¨½", "Notes": "è»Šç¨‹ç´„ä¸€å°æ™‚"},
                {"Date": "2026/04/11", "City": "ä¸­åˆ", "Category": "é¤å»³", "Time": "12:00", "Activity": "å°æ¨½åˆé¤ (å€™é¸)", "Notes": "Takara Sushi / cafe BAAL / Takinami / Naruto Main Shop"},
                {"Date": "2026/04/11", "City": "æœ­å¹Œ", "TimeOfDay": "ä¸‹åˆ", "Category": "æ™¯é»", "Time": "14:00", "Activity": "å°æ¨½é‹æ²³èˆ‡ä¼´æ‰‹ç¦®", "Notes": "å…­èŠ±äº­ã€åŒ—è“æ¨“ã€LeTAO"},
                {"Date": "2026/04/11", "City": "æœ­å¹Œ", "TimeOfDay": "ä¸‹åˆ", "Category": "äº¤é€š", "Time": "17:00", "Activity": "åŒ…è»Šå‰å¾€è—»å²©å±±", "Notes": "é ç´„ MK Taxi"},
                {"Date": "2026/04/11", "City": "æœ­å¹Œ", "TimeOfDay": "æ™šä¸Š", "Category": "æ™¯é»", "Time": "18:00", "Activity": "è—»å²©å±±çºœè»Šå¤œæ™¯", "Notes": "éœ€è¦é ç´„"},
                {"Date": "2026/04/11", "City": "æœ­å¹Œ", "TimeOfDay": "æ™šä¸Š", "Category": "é¤å»³", "Time": "20:00", "Activity": "è–„é‡ç‡’è‚‰å–œæ¨‚", "Notes": "21:00 å¾Œå¥—é¤ 6600yen"},
                {"Date": "2026/04/12", "City": "æ´çˆºæ¹–", "TimeOfDay": "æ—©ä¸Š", "Category": "é¤å»³", "Time": "11:00", "Activity": "è¾›ã„ãƒ©ãƒ¼ãƒ¡ãƒ³ï¼‘ï¼” æ‹‰éºµ", "Notes": "æœ­å¹Œå—å£æœ¬åº—"},
                {"Date": "2026/04/12", "City": "æ´çˆºæ¹–", "TimeOfDay": "ä¸­åˆ", "Category": "äº¤é€š", "Time": "12:10", "Activity": "å‰å¾€å¤§é€š 31å‡ºå£", "Notes": "æ¥é§è»Šé›†åˆ"},
                {"Date": "2026/04/12", "City": "æ´çˆºæ¹–", "TimeOfDay": "ä¸‹åˆ", "Category": "äº¤é€š", "Time": "13:00", "Activity": "æ¥é§è»Šå‰å¾€æ´çˆºæ¹–", "Notes": "13:00 ç™¼è»Š"},
                {"Date": "2026/04/12", "City": "æ´çˆºæ¹–", "TimeOfDay": "ä¸‹åˆ", "Category": "ä½å®¿", "Time": "15:30", "Activity": "é£¯åº— Check in", "Notes": "ã‚¶ãƒ»ãƒ¬ã‚¤ã‚¯ã‚¹ã‚¤ãƒ¼ãƒˆæ¹–ã®æ –"},
                {"Date": "2026/04/12", "City": "æ´çˆºæ¹–", "TimeOfDay": "ä¸‹åˆ", "Category": "æ™¯é»", "Time": "", "Activity": "æ´çˆºæ¹–å•†åº—è¡—", "Notes": "è‡ªç”±æ´»å‹•"},
                {"Date": "2026/04/12", "City": "æ´çˆºæ¹–", "TimeOfDay": "æ™šä¸Š", "Category": "é¤å»³", "Time": "18:30", "Activity": "é£¯åº—æ™šé¤", "Notes": "å·²é ç´„"},
                {"Date": "2026/04/13", "City": "æ´çˆºæ¹–", "TimeOfDay": "æ—©ä¸Š", "Category": "é¤å»³", "Time": "09:00", "Activity": "é£¯åº—æ—©é¤", "Notes": ""},
                {"Date": "2026/04/13", "City": "æ´çˆºæ¹–", "TimeOfDay": "æ—©ä¸Š", "Category": "æ™¯é»", "Time": "10:00", "Activity": "æœ‰ç å±±çºœè»Š (Mount Usu)", "Notes": "çœºæœ›æ´çˆºæ¹–æ˜­å’Œæ–°å±±"},
                {"Date": "2026/04/13", "City": "æ´çˆºæ¹–", "TimeOfDay": "æ—©ä¸Š", "Category": "äº¤é€š", "Time": "11:15", "Activity": "æ­ä¹˜å·´å£«ç§»å‹•", "Notes": ""},
                {"Date": "2026/04/13", "City": "æ´çˆºæ¹–", "TimeOfDay": "ä¸­åˆ", "Category": "é¤å»³", "Time": "12:00", "Activity": "æ´çˆºæ¹–å•†åº—è¡—åƒåˆé¤", "Notes": ""},
                {"Date": "2026/04/13", "City": "æ´çˆºæ¹–", "TimeOfDay": "ä¸‹åˆ", "Category": "æ™¯é»", "Time": "12:45", "Activity": "Lake Hill Farm", "Notes": "åƒå†°æ·‡æ·‹ (17:00 é—œé–€)"},
                {"Date": "2026/04/13", "City": "æ´çˆºæ¹–", "TimeOfDay": "ä¸‹åˆ", "Category": "æ™¯é»", "Time": "14:30", "Activity": "ä¸­å³¶è§€å…‰ (Nakajima Museum)", "Notes": ""},
                {"Date": "2026/04/13", "City": "æ´çˆºæ¹–", "TimeOfDay": "æ™šä¸Š", "Category": "é¤å»³", "Time": "18:30", "Activity": "é£¯åº—æ™šé¤", "Notes": ""},
                {"Date": "2026/04/14", "City": "æ©Ÿå ´", "TimeOfDay": "æ—©ä¸Š", "Category": "äº¤é€š", "Time": "10:00", "Activity": "åŒ…è»Šå‰å¾€æ–°åƒæ­²æ©Ÿå ´", "Notes": "1.5-2å°æ™‚è»Šç¨‹"},
                {"Date": "2026/04/14", "City": "æ©Ÿå ´", "TimeOfDay": "ä¸‹åˆ", "Category": "äº¤é€š", "Time": "15:00-18:15", "Activity": "CI 131 å›ç¨‹", "Notes": "æ©Ÿå ´æœ€å¾Œæ¡è²·"},
                {"Date": "2026/04/14", "City": "æ©Ÿå ´", "TimeOfDay": "æ™šä¸Š", "Category": "äº¤é€š", "Time": "ç´„19:00", "Activity": "å„è‡ªå›å®¶", "Notes": "æ©Ÿæ· / ç™½ç‰Œ / å°å—é–‹è»Š"}
            ],
            packing: [
                {category: "å¿…å‚™è­‰ä»¶èˆ‡è²¡ç‰©", items: ["è­·ç…§", "æ—¥å¹£", "å°å¹£", "ä¿¡ç”¨å¡", "å®¶è£¡é‘°åŒ™"]},
                {category: "è¡£ç‰©èˆ‡ä¿æš–", items: ["æ›æ´—è¡£ç‰©", "å…§è¡£è¤²", "è¥ªå­", "è–„å¤–å¥—", "å¤ªé™½çœ¼é¡", "å¸½å­"]},
                {category: "é›»å­ç”¨å“", items: ["æ‰‹æ©Ÿ", "å……é›»å™¨", "è¡Œå‹•é›»æº", "è€³æ©Ÿ", "é›»è…¦ï¼‹å……é›»å™¨ (å§Šå§Š)", "ç›¸æ©ŸåŠè¨˜æ†¶å¡"]},
                {category: "è¡›ç”Ÿèˆ‡è—¥å“", items: ["ç‰™åˆ·ç‰™è†", "æ´—é¢ä¹³", "ä¿é¤Šå“", "å¸¸å‚™è—¥å“", "å£ç½©", "OKç¹ƒ", "éš±å½¢çœ¼é¡"]},
                {category: "å…¶ä»–å¯¦ç”¨ç‰©å“", items: ["é›¨å‚˜ (æŠ˜ç–Š)", "æ°´ç“¶/ä¿æº«ç“¶", "ç’°ä¿è¢‹", "æ—…è¡Œæ•", "çœ¼ç½©", "è€³å¡"]}
            ],
            conv_store: [
                {
                    "store": "ğŸ‘‘ Seicomart (åŒ—æµ·é“é™å®šå¿…åƒ)",
                    "items": [
                        {"name": "Hot Chef ç¾ç‚¸è±¬æ’ä¸¼", "desc": "çµ•å°å† è»ï¼åº—å…§ç¾ç…®ï¼Œè‚‰åšä¸”è›‹æ¶²æ»‘å«©ã€‚"},
                        {"name": "Hot Chef ç¾åšå¤§é£¯ç³°", "desc": "æº«ç†±å·¨å¤§ï¼Œæ¨è–¦ã€Œæ˜å¤ªå­ã€æˆ–ã€Œé®­é­šã€ã€‚"},
                        {"name": "é“ç”¢ç¾ç‚¸é¦¬éˆ´è–¯", "desc": "100% åŒ—æµ·é“ç”¢ï¼Œå£æ„Ÿé¬†è»Ÿåº¦é©šäººã€‚"},
                        {"name": "é–€å¸‚ç¾çƒ¤ç‰›è§’éºµåŒ…", "desc": "æ³•åœ‹é€²å£æ´¾çš®é–€å¸‚ç¾çƒ¤ï¼Œå¤–é…¥å…§è»Ÿã€‚"},
                        {"name": "å“ˆå¯†ç“œéœœæ·‡æ·‹", "desc": "è‡ªæœ‰å“ç‰Œ Secoma ä½¿ç”¨é“ç”¢å“ˆå¯†ç“œã€‚"},
                        {"name": "å±±èŠ¥æœ«é¹½æ‹‰éºµ (æ³¡éºµ)", "desc": "åŒ—æµ·é“ç‰¹ç”¢ï¼Œè¾›è¾£æ„Ÿç›´è¡è…¦é–€ã€‚"},
                        {"name": "Secoma é“ç”¢ç‰›ä¹³", "desc": "100% åŒ—æµ·é“åŸç”¢ï¼Œå¥¶å‘³ç´”ç²¹é †å£ã€‚"},
                        {"name": "100æ—¥åœ“ç¾©å¤§åˆ©éºµ", "desc": "CPå€¼ä¹‹ç‹ï¼Œå¤šç¨®åœ¨åœ°å£å‘³ã€‚"},
                        {"name": "G7 ç³»åˆ—ç´…ç™½é…’", "desc": "é«˜å“è³ªä½åƒ¹ä½ï¼ŒSeicomart ç¨å®¶ã€‚"},
                        {"name": "åŒ—æµ·é“å“ˆå¯†ç“œæ²™ç“¦", "desc": "å……æ»¿å¤©ç„¶æœé¦™çš„ä½é…’ç²¾é£²æ–™ã€‚"}
                    ]
                },
                {
                    "store": "ğŸª Lawson (ç”œé»ä¹‹ç‹)",
                    "items": [
                        {"name": "BASCHEE èµ·å¸è›‹ç³•", "desc": "ç„¦ç³–å‘³æ¿ƒéƒï¼Œè¶…å•†ç”œé»ç¶“å…¸ã€‚"},
                        {"name": "éº»ç³¬å£æ„Ÿè›‹ç³•æ²", "desc": "Qå½ˆè›‹ç³•çš®é…ä¸Šåšç”Ÿä¹³é¤¡ã€‚"},
                        {"name": "ç”Ÿç«è…¿åŒ…å¥¶æ²¹ä¹³é…ª", "desc": "ã€å¿…åƒã€‘ä¸‹é…’ç¥èœï¼Œå¥¶æ²¹èµ·å¸æ¿ƒéƒã€‚"},
                        {"name": "ç‚¸é›å› (ã‹ã‚‰ã‚ã’ã‚¯ãƒ³)", "desc": "æ¨ã€ŒåŒ—æµ·é“èµ·å¸ã€å£å‘³ï¼Œé¦™å«©å¤šæ±ã€‚"},
                        {"name": "Uchi CafÃ© x GODIVA è¯å", "desc": "æ¯å­£å¿…æ¶çš„é«˜ç´šå·§å…‹åŠ›ç”œé»ç³»åˆ—ã€‚"},
                        {"name": "Premium Roll Cake", "desc": "ç”¨æ¹¯åŒ™æŒ–è‘—åƒçš„ç¶“å…¸ç”Ÿä¹³æ²ã€‚"},
                        {"name": "è˜­å§†è‘¡è„å¤¾å¿ƒé¤…ä¹¾", "desc": "é…’é¦™èˆ‡ä¹³é…ªæ¯”ä¾‹å®Œç¾ã€‚"},
                        {"name": "Machikado å»šæˆ¿ä¾¿ç•¶", "desc": "åº—å…§ç¾åšä¾¿ç•¶ï¼Œæ–°é®®åº¦å‹éå†·è—ã€‚"},
                        {"name": "ä½ç³–è³ªç³»åˆ—éºµåŒ…", "desc": "å¥åº·æ„è­˜æ—é¦–é¸ã€‚"}
                    ]
                },
                {
                    "store": "ğŸª 7-Eleven (å“è³ªé¦–é¸)",
                    "items": [
                        {"name": "é›ªè‚Œç²¹ç³»åˆ—ç”¢å“", "desc": "7-11ç¨å®¶ï¼Œæ´—é¢ä¹³èˆ‡ BB éœœå¿…è²·ã€‚"},
                        {"name": "é›è›‹æ²™æ‹‰ä¸‰æ˜æ²»", "desc": "è›‹é¦™æ¿ƒéƒä¸”åå¸æ¥µå…¶è»Ÿç¶¿ã€‚"},
                        {"name": "ç ‚ç³–å¥¶æ²¹æ¨¹é¤…ä¹¾ (è¯åæ¬¾)", "desc": "å¿…è²·è¶…å•†è¯åä¼´æ‰‹ç¦®ï¼Œå“è³ªæ¥µé«˜ã€‚"},
                        {"name": "å·§å…‹åŠ›ä¸€å£é…¥é¤…ä¹¾", "desc": "100æ—¥åœ“è¦ªæ°‘åƒ¹ï¼Œå·§å…‹åŠ›æ§å¿…è²·ã€‚"},
                        {"name": "ç¾æ‰“æœæ˜” (Smoothie)", "desc": "ç¾å ´æ©Ÿå™¨æ”ªæ‹Œï¼Œæ–°é®®çœ‹å¾—è¦‹ã€‚"},
                        {"name": "Nanachiki ç‚¸é›", "desc": "ç¨é–€è¾›é¦™æ–™èª¿å‘³ï¼Œçš®è–„å¤šæ±ã€‚"},
                        {"name": "é‡‘ä¹‹ç‡‰ç‰›è‚‰ (è¢‹è£)", "desc": "ã€Œé‡‘ç³»åˆ—ã€ä»£è¡¨ä½œï¼Œè‚‰å¡Šå…¥å£å³åŒ–ã€‚"}
                    ]
                },
                {
                    "store": "ğŸª FamilyMart (å…¨å®¶é™å®š)",
                    "items": [
                        {"name": "å…¨å®¶ç‚¸é› (FamiChiki)", "desc": "ç„¡éª¨è„†çš®å¤šæ±ï¼Œæ¨™èªŒå•†å“ã€‚"},
                        {"name": "èˆ’èŠ™è•¾å¸ƒä¸", "desc": "ç¶¿å¯†è›‹ç³•æ­é…æ¿ƒéƒå¸ƒä¸ã€‚"},
                        {"name": "ç‰§å ´ç‰›å¥¶å†°æ·‡æ·‹", "desc": "åŒ…è£å¯æ„›ï¼Œå¥¶å‘³æ¿ƒåº¦æ¥µé«˜ã€‚"},
                        {"name": "FamilyMart å’–å•¡å†°æ²™", "desc": "å€’å…¥ç†±ç‰›å¥¶æ”ªæ‹Œã€‚"},
                        {"name": "ç…§ç‡’é›è‚‰è›‹é£¯ç³°", "desc": "ç¶“å…¸æ—¥å¼é¢¨å‘³ã€‚"},
                        {"name": "æ‰‹æé¢¨æ ¼å¤§é£¯ç³°", "desc": "é¡ä¼¼ç¾åšå£æ„Ÿã€‚"}
                    ]
                }
            ]
        };

        function travelApp() {
            return {
                tab: 'schedule', selectedDate: '2026/04/09', searchQuery: '',
                dates: [...new Set(FULL_DATA.itinerary.map(i => i.Date))],
                packing: FULL_DATA.packing, conv_store: FULL_DATA.conv_store,
                tabIcons: { schedule: 'calendar', info: 'info', packing: 'briefcase', store: 'shopping-bag', budget: 'wallet' },
                tabNames: { schedule: 'è¡Œç¨‹', info: 'è³‡è¨Š', packing: 'è¡Œæ', store: 'è¶…å•†', budget: 'è¨˜å¸³' },
                checkedItems: JSON.parse(localStorage.getItem('hk_p_v17') || '{}'),
                expenses: JSON.parse(localStorage.getItem('hk_b_v17') || '[]'),
                newExpense: { desc: '', amount: '', currency: 'JPY', category: 'é£Ÿ' },
                
                init() {
                    lucide.createIcons();
                    this.$watch('tab', () => this.$nextTick(() => lucide.createIcons()));
                    this.$watch('checkedItems', v => localStorage.setItem('hk_p_v17', JSON.stringify(v)));
                    this.$watch('expenses', v => localStorage.setItem('hk_b_v17', JSON.stringify(v)));
                },
                
                // åˆ¤æ–·æ˜¯å¦é¡¯ç¤ºåœ°åœ–é€£çµ
                shouldShowMap(activity) {
                    if (!activity) return false;
                    const excluded = ['å„è‡ªå›å®¶', 'ä¾¿åˆ©å•†åº—', 'check out', 'å·´å£«', 'å„è‡ªå‰å¾€', 'è‡ªç”±æ´»å‹•', 'å„è‡ªå‰å¾€', 'å¼„é ­é«®'];
                    return !excluded.some(term => activity.toLowerCase().includes(term));
                },

                get selectedCity() { return FULL_DATA.itinerary.find(i => i.Date === this.selectedDate)?.City || 'æœ­å¹Œ'; },
                get filteredItinerary() {
                    let items = FULL_DATA.itinerary.filter(i => i.Date === this.selectedDate);
                    if (this.searchQuery) return items.filter(i => i.Activity.includes(this.searchQuery) || (i.Notes && i.Notes.includes(this.searchQuery)));
                    return items;
                },
                get totalJPY() { return this.expenses.reduce((acc, cur) => acc + (cur.currency === 'JPY' ? cur.amount : cur.amount / 0.22), 0); },
                get totalTWD() { return Math.round(this.totalJPY * 0.22); },
                get chartPercent() { return this.totalJPY > 0 ? Math.min(100, Math.round((this.totalJPY / 200000) * 100)) : 0; },
                getCatTotal(cat) { return this.expenses.filter(e => e.category === cat).reduce((acc, cur) => acc + (cur.currency === 'JPY' ? cur.amount : cur.amount / 0.22), 0); },
                addExpense() {
                    if (!this.newExpense.desc || !this.newExpense.amount) return;
                    this.expenses.unshift({ ...this.newExpense, id: Date.now(), date: new Date().toLocaleDateString() });
                    this.newExpense = { desc: '', amount: '', currency: 'JPY', category: 'é£Ÿ' };
                },
                deleteExpense(index) { this.expenses.splice(index, 1); },
                getCategoryEmoji(cat) { const map = {é£Ÿ: 'ğŸ½ï¸', è¡Œ: 'ğŸšŒ', ä½: 'ğŸ¨', è³¼: 'ğŸ›ï¸', ä»–: 'ğŸ“¦'}; return map[cat] || 'ğŸ’°'; },
                getCatStyles(cat) {
                    const styles = { 'äº¤é€š': { bg: 'bg-blue-400', text: 'text-blue-500', icon: 'bus' }, 'é¤å»³': { bg: 'bg-rose-400', text: 'text-rose-500', icon: 'utensils' }, 'æ™¯é»': { bg: 'bg-green-400', text: 'text-green-500', icon: 'camera' }, 'ä½å®¿': { bg: 'bg-indigo-400', text: 'text-indigo-500', icon: 'home' }, 'é€›è¡—': { bg: 'bg-pink-400', text: 'text-pink-500', icon: 'shopping-bag' }, 'å…¶ä»–': { bg: 'bg-gray-400', text: 'text-gray-500', icon: 'more-horizontal' } };
                    return styles[cat] || styles['å…¶ä»–'];
                }
            }
        }
    </script>
</body>
</html>
